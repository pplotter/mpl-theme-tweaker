name: Windows Release Build (PyInstaller Folder)

on:
  push:
    tags:
      - "v[0-9]+.[0-9]+.[0-9]+" # åŒ¹é… v1.0.0, v2.3.4 ç­‰æ ‡ç­¾

jobs:
  build_and_release:
    permissions:
      contents: write

    runs-on: windows-latest

    env:
      TAG_NAME: ${{ github.ref_name }}
      EXE_NAME: mpl-theme-tweaker

    steps:
      - name: ğŸ“¦ Checkout code
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: ğŸ Set up Python Environment
        uses: actions/setup-python@v5
        with:
          python-version: "3.13"

      - name: ğŸ›  Install dependencies with uv (PyInstaller and Project Deps)
        run: |
          python -m pip install uv

          uv sync

      - name: ğŸ”¨ Build with PyInstaller (Folder Mode)
        run: |
          cd pyinstaller/

          uv run pyinstaller mpl-theme-tweaker.spec

      - name: ğŸ“‚ Zip the build directory
        run: |
          $ZipFileName = "${{ env.EXE_NAME }}-${{ env.TAG_NAME }}-Windows-Folder.zip"

          Compress-Archive -Path ./pyinstaller/dist/${{ env.EXE_NAME }} -DestinationPath $ZipFileName

      - name: ğŸš€ Create GitHub Release and Upload Asset
        uses: softprops/action-gh-release@v2
        with:
          name: Release ${{ env.TAG_NAME }}
          body: |
            ğŸ‰ **${{ env.TAG_NAME }}** Windows (Folder Build) Stable Release.

            This ZIP file contains a self-contained folder with the executable and all dependencies.
          files: |
            ./${{ env.EXE_NAME }}-${{ env.TAG_NAME }}-Windows-Folder.zip
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
